# Maintainer: Marco van den Oever <arch@flyingpie.nl>
_pkgname=wtq
pkgname=$_pkgname-bin
pkgver=2.0.17.1
pkgrel=1
pkgdesc="Enable Quake-style dropdown for (almost) any application."
arch=('x86_64')
url="https://github.com/flyingpie/windows-terminal-quake"
license=('MIT')
depends=(
  'libappindicator-gtk3'
  'webkit2gtk-4.1'
)
provides=()
conflicts=()
source=(
  "${pkgname}-${pkgver}.tar.gz::${url}/releases/download/v${pkgver}/linux-x64_self-contained.tar.gz"
)
noextract=()
sha256sums=(
  "c5b613eab581d60bc64565c1c4ccba464ad6abba56a47abb5bb65b49028d4fb4"
)
validpgpkeys=()

package() {
	# Remove downloaded archive
	rm $srcdir/wtq-*.tar.gz

	# Set target paths
	app_dir="$pkgdir/opt/wtq"
	app_bin="$pkgdir/opt/wtq/wtq"

	install -Ddm755 $app_dir # Create install dir
	cp -R $srcdir/* $app_dir # Copy app files to install dir
	chmod -R 755 $app_dir

	# Create symlink in /usr/bin
	install -Ddm755 "$pkgdir/usr/bin"
	ln -s "/opt/wtq/wtq" "$pkgdir/usr/bin/wtq"

	# Create .desktop file
	install -d "$pkgdir/usr/share/applications"
	cat > "$pkgdir/usr/share/applications/wtq.desktop" <<EOF
[Desktop Entry]
Name=WTQ
Exec=env WEBKIT_DISABLE_DMABUF_RENDERER=1 /opt/wtq/wtq
Version=1.0
Type=Application
Categories=
Terminal=false
Icon=/opt/wtq/assets/icon-v2-64.png
Comment=Enable Quake-mode for (almost) any app
StartupNotify=true
EOF
}
@using Wtq.Services.UI.Extensions

@inherits BaseAppPanel

@code {

	private KeyModifiers _testKeyModifiers;
	private Keys _testKey;

	private Keys[] KeysValues { get; } = WtqConstants.CommonKeys;

	private class KeyDto
	{
		public Keys Key { get; set; }

		public string Description { get; set; }
	}

	private void HandleKeyDown(KeyboardEventArgs e)
	{
		e.ToModifiersAndKey(out var mod, out var key);

		_testKeyModifiers = mod;
		_testKey = key;

		//value1 = $"[CTRL:{e.CtrlKey} ALT:{e.AltKey} SHIFT:{e.ShiftKey} META:{e.MetaKey}] KEY:{e.Key} CODE:{e.Code} REPEAT:{e.Repeat} TYPE:{e.Type}";
	}
}

<RadzenFieldset Text="App">
	<RadzenStack Gap="1rem">

		<!-- Name -->
		<RadzenRow AlignItems="AlignItems.Start">
			<SettingLabel Text="Name" Component="Name"/>
			<RadzenColumn Size="7">
				<RadzenTextBox @bind-Value="AppOpts.Name" Name="Name" style="width: 100%;"/>

				<Descr>
					A descriptive name, mostly used for logging.
				</Descr>
			</RadzenColumn>
		</RadzenRow>

		<!-- Hotkeys -->
		<RadzenRow AlignItems="AlignItems.Start">
			<SettingLabel Text="Hotkeys"/>
			<RadzenColumn Size="7">

				<RadzenStack>

					@* MOD:@(_testKeyModifiers.GetDisplayDescription()) *@
					@* KEY:@(_testKey.GetDisplayDescription()) *@

					@*
						TODO: Textbox to auto-detect the pressed key. Works great, but we need to disable
						registered hotkeys for this to work properly, otherwise we're triggering already-bound apps.
					*@

					@* <RadzenTextBox *@
					@* 	Style="width: 100%;" *@
					@* 	@onkeydown="(ev) => HandleKeyDown(ev)" *@
					@* 	Placeholder="Type here to set hotkey." *@
					@* 	Value="" *@
					@* /> *@

					@foreach (var hk in AppOpts?.Hotkeys ?? [])
					{
						<RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center" Gap="8">

							<!-- Alt -->
							<RadzenToggleButton
								Text="Alt"
								@bind-Value="hk.IsAlt"
								Size="ButtonSize.Medium"
								ButtonStyle="ButtonStyle.Light"
								ToggleButtonStyle="ButtonStyle.Primary"
								Style="width: 8em;"
							/>

							<!-- Ctrl -->
							<RadzenToggleButton
								Text="Ctrl"
								@bind-Value="hk.IsCtrl"
								Size="ButtonSize.Medium"
								ButtonStyle="ButtonStyle.Light"
								ToggleButtonStyle="ButtonStyle.Primary"
								Style="width: 8em;"
							/>

							<!-- Shift -->
							<RadzenToggleButton
								Text="Shift"
								@bind-Value="hk.IsShift"
								Size="ButtonSize.Medium"
								ButtonStyle="ButtonStyle.Light"
								ToggleButtonStyle="ButtonStyle.Primary"
								Style="width: 8em;"
							/>

							<!-- Key -->
							<RadzenDropDown
								@bind-Value="hk.Key"
								Data=@(KeysValues)
								Style="width: 100%; max-width: 400px;"
								Name="AnimationTypeToggleOn1"
							/>

							<!-- Remove button -->
							<RadzenButton
								Icon="delete"
								Size="ButtonSize.Medium"
								Click="@(() => AppOpts.Hotkeys.Remove(hk))"
							/>
						</RadzenStack>
					}

					<RadzenStack>
						<RadzenButton
							Icon="add"
							Size="ButtonSize.Medium"
							Click="@(() => AppOpts.Hotkeys.Add(new()))"
						/>
					</RadzenStack>
				</RadzenStack>

				<Descr>What hotkeys should toggle the app.</Descr>
			</RadzenColumn>
			<SettingGlobal/>
		</RadzenRow>
	</RadzenStack>
</RadzenFieldset>